<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <video src="/test.mp4" class="img-responsive" onloadeddata="loadVideo()" style="width:100%" webkit-playsinline> </video>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-10 col-xs-offset-1">
                <!-- <div class="btn btn-success" onclick="play()">播放</div> -->
                <!-- <div class="btn btn-success" onclick="pause()">暂停调试</div> -->
                <div class="btn btn-success" onclick="bishun()">笔顺</div>
                <div class="btn btn-success" onclick="fenbi()">分笔</div>
                <div class="btn btn-success" onclick="next()" id="next">下一笔</div>
                <div class="btn btn-success" onclick="replay()">重复</div>
            </div>

        </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script>
        /** state 0 笔顺 1分笔 */

        let state = 1;
        let current = 1;
        let videoEl = document.getElementsByTagName('video')[0];
        let times = [0];

        function play() {
            videoEl.play();
        }

        function pause() {
            videoEl.pause()
            console.log(videoEl.currentTime);
        }

        function loadVideo() {
            state = 1;


        }
        let max = 8;
        loadVideo();
        let timmer;

        function bishun() {
            state = 0;
            current = 1;
            videoEl.src = "video/爸.mp4"
            videoEl.pause();
            videoEl.currentTime = 0;
            videoEl.play();
            disableNext();
        }

        function fenbi() {
            videoEl.pause();
            state = 1;
            current = 0;
            videoEl.currentTime = 0;
            enableNext()

        }

        function next() {
            current++;
            replay();
        }

        function replay() {
            if (state == 0) {
                bishun();
            } else {
                if (timmer) {
                    clearTimeout(timmer);
                }
                videoEl.pause();
                videoEl.src = "/video/爸_" + (current) + '.mp4';
                videoEl.play();
                videoEl.onended = function() {
                    videoEl.currentTime = videoEl.duration - .1
                }
                console.log(`第${current}笔`, );
                videoEl.onloadeddata = function() {
                    setTimeout(() => {
                        videoEl.pause();
                    }, (videoEl.duration - 0.01) * 1000)
                }
                if (current >= 8) {
                    disableNext();
                }
            }
        }

        function disableNext() {
            $('#next').attr('disabled', 'disabled').attr('onclick', false);

        }

        function enableNext() {
            $('#next').attr('disabled', false);
            $('#next').attr('onclick', 'next()');

        }
    </script>

</body>

</html>